<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nim — JeHathor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cinzel:wght@400;600&family=Raleway:wght@300;400&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="css/shared.css" />
    <link rel="stylesheet" href="css/nim.css" />
</head>
<body>
    <div class="container">

        <div class="site-header">
            <div class="logo-rule"><div class="diamond"></div><h1>Nim</h1><div class="diamond"></div></div>
            <p class="subtitle">Take the last stick to win</p>
        </div>

        <div class="scores">
            <div class="score-card">
                <div class="score-label" id="playerLabel">Human Player</div>
                <div class="score-value player-score" id="playerScore">0</div>
            </div>
            <div class="score-card">
                <div class="score-label">NimBot</div>
                <div class="score-value bot-score" id="botScore">0</div>
            </div>
        </div>

        <div class="sticks-container" id="sticksContainer"></div>
        <div class="remaining" id="remaining">20 sticks remaining</div>

        <span class="control-label">Take sticks (max <span id="maxLabel">3</span>):</span>
        <div class="button-group" id="buttonGroup"></div>

        <button class="take-btn" id="takeBtn">Take 1 stick</button>
        <button class="new-game-btn hidden" id="newGameBtn">◆ &nbsp; New Game &nbsp; ◆</button>

        <div class="divider"><span>◆</span></div>

        <div class="settings">
            <div>
                <label class="setting-label" for="difficulty">Difficulty</label>
                <select id="difficulty">
                    <option value="Easy">Easy</option>
                    <option value="Medium">Medium</option>
                    <option value="Hard" selected>Hard</option>
                    <option value="Expert">Expert</option>
                </select>
            </div>
            <div>
                <label class="setting-label" for="playerName">Player Name</label>
                <input type="text" id="playerName" value="Human Player">
            </div>
        </div>

        <div class="log-container">
            <div class="log-title">Game Log</div>
            <div class="log-scroll" id="gameLog">
                <div class="log-entry">No moves yet...</div>
            </div>
        </div>

    </div>

    <script>
        const game = {
            sticks: 20,
            maxTake: 3,
            playerScore: 0,
            botScore: 0,
            difficulty: 'Hard',
            playerName: 'Human Player',
            selectedAmount: 1,
            isGameOver: false,
            isFirstMove: true,
            logs: []
        };

        function renderSticks() {
            const container = document.getElementById('sticksContainer');
            container.innerHTML = '';
            for (let i = 0; i < game.sticks; i++) {
                const stick = document.createElement('div');
                stick.className = 'stick stick-pop';
                stick.style.animationDelay = `${i * 0.02}s`;
                container.appendChild(stick);
            }
        }

        function updateRemaining() {
            document.getElementById('remaining').textContent =
                `${game.sticks} stick${game.sticks !== 1 ? 's' : ''} remaining`;
        }

        function renderButtons() {
            const container = document.getElementById('buttonGroup');
            container.innerHTML = '';
            let max = Math.min(game.maxTake, game.sticks);
            if (game.isFirstMove && game.playerScore <= game.botScore) {
                max = Math.min(game.maxTake + 1, game.sticks);
            }
            document.getElementById('maxLabel').textContent = max;
            for (let i = 1; i <= max; i++) {
                const btn = document.createElement('button');
                btn.className = 'select-btn' + (i === game.selectedAmount ? ' selected' : '');
                btn.textContent = i;
                btn.onclick = () => selectAmount(i);
                container.appendChild(btn);
            }
        }

        function selectAmount(amount) {
            game.selectedAmount = amount;
            renderButtons();
            document.getElementById('takeBtn').textContent =
                `Take ${amount} stick${amount > 1 ? 's' : ''}`;
        }

        function addLog(message, type = '') {
            game.logs.push({ message, type });
            const logContainer = document.getElementById('gameLog');
            logContainer.innerHTML = game.logs.map(log =>
                `<div class="log-entry ${log.type}">${log.message}</div>`
            ).join('');
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function calculateOptimalMove(remainingSticks) {
            if (remainingSticks <= game.maxTake) return remainingSticks;
            const optimalTake = remainingSticks % (game.maxTake + 1);
            if (optimalTake === 0) return Math.floor(Math.random() * game.maxTake) + 1;
            return optimalTake;
        }

        function botMove(remainingSticks) {
            let amount;
            if (game.difficulty === 'Easy') {
                amount = Math.floor(Math.random() * game.maxTake) + 1;
            } else if (game.difficulty === 'Medium') {
                amount = Math.random() > 0.4
                    ? Math.floor(Math.random() * game.maxTake) + 1
                    : calculateOptimalMove(remainingSticks);
            } else if (game.difficulty === 'Hard') {
                let threshold = remainingSticks > 16 ? 0.5 : remainingSticks > 8 ? 0.7 : 0.9;
                amount = Math.random() > threshold
                    ? Math.floor(Math.random() * game.maxTake) + 1
                    : calculateOptimalMove(remainingSticks);
            } else {
                amount = calculateOptimalMove(remainingSticks);
            }
            return Math.min(amount, remainingSticks);
        }

        function playerTake() {
            if (game.isGameOver || game.sticks === 0) return;

            const taken = Math.min(game.selectedAmount, game.sticks);
            game.sticks -= taken;
            game.isFirstMove = false;

            addLog(`${game.playerName} took ${taken} stick${taken > 1 ? 's' : ''}`, 'player');
            renderSticks();
            updateRemaining();

            if (game.sticks === 0) {
                addLog(`${game.playerName} wins!`, 'win');
                game.playerScore++;
                document.getElementById('playerScore').textContent = game.playerScore;
                endGame();
                return;
            }

            renderButtons();
            document.getElementById('takeBtn').disabled = true;

            setTimeout(() => {
                const botAmount = botMove(game.sticks);
                game.sticks -= botAmount;

                addLog(`NimBot took ${botAmount} stick${botAmount > 1 ? 's' : ''}`, 'bot');
                renderSticks();
                updateRemaining();

                if (game.sticks === 0) {
                    addLog('NimBot wins!', 'win');
                    game.botScore++;
                    document.getElementById('botScore').textContent = game.botScore;
                    endGame();
                } else {
                    renderButtons();
                    document.getElementById('takeBtn').disabled = false;
                }
            }, 800);
        }

        function endGame() {
            game.isGameOver = true;
            document.getElementById('takeBtn').classList.add('hidden');
            document.getElementById('newGameBtn').classList.remove('hidden');
        }

        function newGame() {
            game.sticks = 20;
            game.isGameOver = false;
            game.isFirstMove = true;
            game.selectedAmount = 1;
            game.logs = [];

            document.getElementById('gameLog').innerHTML = '<div class="log-entry">No moves yet...</div>';
            document.getElementById('takeBtn').classList.remove('hidden');
            document.getElementById('newGameBtn').classList.add('hidden');
            document.getElementById('takeBtn').disabled = false;
            document.getElementById('takeBtn').textContent = 'Take 1 stick';

            renderSticks();
            updateRemaining();
            renderButtons();
        }

        document.getElementById('takeBtn').onclick = playerTake;
        document.getElementById('newGameBtn').onclick = newGame;
        document.getElementById('difficulty').onchange = e => { game.difficulty = e.target.value; };
        document.getElementById('playerName').oninput = e => {
            game.playerName = e.target.value;
            document.getElementById('playerLabel').textContent = e.target.value;
        };

        renderSticks();
        renderButtons();
    </script>

    <footer>&copy; JeHathor &nbsp;·&nbsp; Hosted on GitHub Pages</footer>

</body>
</html>
